DECLARE @HOJE AS VARCHAR(8) = '20161214'

SELECT ISNULL(SZA.D_E_L_E_T_, ' '),SA1.A1_COD, SA1.A1_LOJA, SA1.A1_NOME, SA1.A1_END, SA1.A1_BAIRRO,
SA1.A1_CEP, SA1.A1_MUN, SA1.A1_EST, SA1.A1_EMAIL, SA1.A1_GRPVEN,
(SELECT TOP 1 ACY.ACY_DESCRI FROM ACY990 ACY WHERE ACY.ACY_GRPVEN = SA1.A1_GRPVEN) ACY_DESCRI,
SE1.E1_FILIAL, SE1.E1_PREFIXO, SE1.E1_NUM, SE1.E1_PARCELA, SE1.E1_TIPO,
SE1.E1_NUMBCO, SE1.E1_EMISSAO, SE1.E1_VENCTO, SE1.E1_SALDO,
DATEDIFF( DAY, CONVERT( DATETIME, SE1.E1_VENCTO ), CONVERT( DATETIME, @HOJE ) ) E1_ATRASO,
DATEDIFF( DAY, CONVERT( DATETIME, ISNULL(SZA.ZA_DATA, '') ), CONVERT(DATETIME, @HOJE ) ) ZA_ULTCOBR
FROM SE1990 SE1

LEFT JOIN SA1990 SA1
ON  SE1.E1_CLIENTE = SA1.A1_COD
AND SE1.E1_LOJA    = SA1.A1_LOJA
AND SA1.D_E_L_E_T_ = ' '

LEFT JOIN SZA990 SZA
ON  SZA.ZA_FILIAL  = SE1.E1_FILIAL
AND SZA.ZA_CLIENTE = SE1.E1_CLIENTE
AND SZA.ZA_LOJA    = SE1.E1_LOJA
AND SZA.ZA_PREFIXO = SE1.E1_PREFIXO
AND SZA.ZA_NUM     = SE1.E1_NUM
AND SZA.ZA_PARCELA = SE1.E1_PARCELA
AND SZA.ZA_TIPO    = SE1.E1_TIPO
AND SZA.ZA_DATA    = '20161214'
AND ISNULL(SZA.D_E_L_E_T_, ' ') = ' '

WHERE SE1.D_E_L_E_T_ = ' '
AND SE1.E1_VENCTO < @HOJE
AND SE1.E1_SALDO  > 0
AND DATEDIFF(DAY, CONVERT(DATETIME, ISNULL(SZA.ZA_DATA, '') ), CONVERT(DATETIME, @HOJE ) ) >= 3