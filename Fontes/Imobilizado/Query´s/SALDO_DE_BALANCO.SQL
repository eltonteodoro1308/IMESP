DECLARE @FILIAL VARCHAR(02) = '01' 
DECLARE @CONTA  VARCHAR(20) = '1222003' 
DECLARE @ANO    VARCHAR(04) = '2017' 

SELECT CT1.CT1_CONTA CONTA, CT1.CT1_DESC01 DESCRICAO,
   
SALDO_DE_BALANCO = ( SELECT COALESCE( SUM( 
         CASE
            WHEN SN5.N5_TIPO IN( '0', '1', '4', '9', 'Q', 'T' ) THEN  SN5.N5_VALOR1 
            WHEN SN5.N5_TIPO IN( '5', '8', 'R', 'S' ) THEN -SN5.N5_VALOR1 
            ELSE 0 
         END ), 0 ) 

		FROM SN5990 SN5 
		WHERE SN5.D_E_L_E_T_ = ' ' 
		AND SN5.N5_CONTA = CT1.CT1_CONTA 
		AND SUBSTRING( SN5.N5_DATA, 1, 4 ) < @ANO)

FROM CT1990 CT1
WHERE CT1.D_E_L_E_T_ = ' ' 
AND ( CT1.CT1_CONTA = @CONTA 
OR  CT1.CT1_CONTA = 
	( SELECT TOP 1 SNG.NG_CCDEPR 
		FROM SNG990 SNG 
		WHERE SNG.NG_CCONTAB = @CONTA 
		AND SNG.D_E_L_E_T_ = ' ' 
	) )